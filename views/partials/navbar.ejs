<% const currentNav=typeof activeNav !=='undefined' ? activeNav : 'home' ; %>
  <nav class="navbar navbar-expand-lg fixed-top px-4">
    <button class="navbar-toggler border-0 text-white d-lg-none me-2 p-0" type="button" data-bs-toggle="offcanvas"
      data-bs-target="#mobileNavbar" aria-controls="mobileNavbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="bi bi-list fs-2"></span>
    </button>
    <a class="navbar-brand" href="#">NETFLIX</a>
    <div class="offcanvas offcanvas-start text-bg-dark d-lg-none" tabindex="-1" id="mobileNavbar"
      aria-labelledby="mobileNavbarLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="mobileNavbarLabel">Browse</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body d-flex flex-column gap-4">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link<%= currentNav === 'home' ? ' active' : '' %>" href="/feed" data-offcanvas-close>Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link<%= currentNav === 'shows' ? ' active' : '' %>" href="/shows" data-offcanvas-close>TV
              Shows</a>
          </li>
          <li class="nav-item">
            <a class="nav-link<%= currentNav === 'movies' ? ' active' : '' %>" href="/movies"
              data-offcanvas-close>Movies</a>
          </li>
          <li class="nav-item">
            <a class="nav-link<%= currentNav === 'list' ? ' active' : '' %>" href="/my-list" data-offcanvas-close>My
              List</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle<%= currentNav === 'genres' ? ' active' : '' %>" href="#"
              id="genresDropdownMobile" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Browse by Genres
            </a>
            <ul class="dropdown-menu bg-dark" aria-labelledby="genresDropdownMobile" id="genresDropdownMenuMobile">
              <li><a class="dropdown-item text-white" href="#">Loading genres...</a></li>
            </ul>
          </li>
        </ul>
        <div class="d-flex flex-column align-items-start gap-3">
          <p class="mb-0 text-white" id="helloMessageMobile">Hello USERNAME</p>
          <a class="d-flex align-items-center text-white gap-2 text-decoration-none" href="profiles"
            data-offcanvas-close>
            <i class="bi bi-person-circle"></i> Select Profile
          </a>
          <a class="d-flex align-items-center text-white gap-2 text-decoration-none" href="/settings"
            data-offcanvas-close>
            <i class="bi bi-gear"></i> Manage Profiles
          </a>
          <button class="btn btn-outline-light btn-sm" type="button" onclick="logout()" data-offcanvas-close>
            <i class="bi bi-box-arrow-right"></i> Log Out
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile search (visible only on small screens) -->
    <div class="d-flex d-lg-none align-items-center gap-2 ms-auto">
      <span class="icon-btn" data-search-target="searchInputMobile"><i class="bi bi-search"></i></span>
      <input id="searchInputMobile" type="text" class="form-control form-control-sm bg-dark text-white"
        placeholder="Search..." style="display: none; width: 150px" />
    </div>

    <div class="collapse navbar-collapse d-none d-lg-flex" id="navbarContent">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link<%= currentNav === 'home' ? ' active' : '' %>" href="/feed">Home</a></li>
        <li class="nav-item"><a class="nav-link<%= currentNav === 'shows' ? ' active' : '' %>" href="/shows">TV
            Shows</a></li>
        <li class="nav-item"><a class="nav-link<%= currentNav === 'movies' ? ' active' : '' %>"
            href="/movies">Movies</a></li>
        <li class="nav-item"><a class="nav-link<%= currentNav === 'list' ? ' active' : '' %>" href="/my-list">My
            List</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle<%= currentNav === 'genres' ? ' active' : '' %>" href="#"
            id="genresDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Browse by Genres
          </a>
          <ul class="dropdown-menu bg-dark" aria-labelledby="genresDropdown" id="genresDropdownMenu">
            <li><a class="dropdown-item text-white" href="#">Loading
                genres...</a></li>
          </ul>
        </li>
      </ul>
      <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center gap-3 gap-lg-2">
        <p class="mb-0 text-white" id="helloMessage">Hello USERNAME</p>
        <span class="icon-btn" data-search-target="searchInput"><i class="bi bi-search"></i></span>
        <input id="searchInput" type="text" class="form-control form-control-sm bg-dark text-white ms-0 ms-lg-2"
          placeholder="Search..." style="display: none; width: 180px" />

        <div class="nav-item dropdown ms-0 ms-lg-2">
          <a id="profileDropdown" class="nav-link dropdown-toggle p-0" role="button" data-bs-toggle="dropdown"
            aria-expanded="false">
            <img id="currentProfileImg" src="/images/profiles/yellow.png" alt="Profile" class="profile-img" />
          </a>

          <ul class="dropdown-menu dropdown-menu-end bg-dark" aria-labelledby="profileDropdown"
            style="min-width: 180px">
            <li>
              <a class="dropdown-item text-white text-start" href="profiles">
                <i class="bi bi-person-circle ms-2 me-2"></i> Select Profile
              </a>
            </li>
            <li>
              <a class="dropdown-item text-white text-start" href="/settings">
                <i class="bi bi-gear ms-2 me-2"></i> Manage Profiles
              </a>
            </li>
            <li>
              <a class="dropdown-item text-white text-start" onclick="logout()" style="cursor: pointer">
                <i class="bi bi-box-arrow-right ms-2 me-2"></i> Log Out
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
  <script>
    (function () {
      if (window.__navbarOffcanvasHooked) return;
      window.__navbarOffcanvasHooked = true;

      const hookOffcanvasListeners = () => {
        const offcanvasEl = document.getElementById("mobileNavbar");
        if (!offcanvasEl || !window.bootstrap || !window.bootstrap.Offcanvas) {
          return;
        }

        const offcanvasInstance = window.bootstrap.Offcanvas.getOrCreateInstance(
          offcanvasEl
        );

        offcanvasEl.addEventListener("click", (event) => {
          const trigger = event.target.closest("[data-offcanvas-close]");
          if (!trigger) return;

          window.requestAnimationFrame(() => {
            offcanvasInstance.hide();
          });
        });
      };

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", hookOffcanvasListeners);
      } else {
        hookOffcanvasListeners();
      }
    })();
  </script>