<% const currentNav = typeof activeNav !== 'undefined' ? activeNav : 'home'; %>
<nav class="navbar navbar-expand-lg navbar-dark fixed-top px-4">
  <a class="navbar-brand" href="/feed">NETFLIX</a>

  <div class="d-flex align-items-center d-lg-none ms-auto gap-2">
    <span class="icon-btn" data-search-target="searchInputMobile"
      ><i class="bi bi-search"></i
    ></span>
    <input
      id="searchInputMobile"
      type="text"
      class="form-control form-control-sm bg-dark text-white"
      placeholder="Search..."
      style="display: none; width: 150px"
    />
    <button
      class="navbar-toggler border-0"
      type="button"
      data-bs-toggle="offcanvas"
      data-bs-target="#mobileNavbar"
      aria-controls="mobileNavbar"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>

  <div class="collapse navbar-collapse d-none d-lg-flex" id="navbarContent">
    <ul class="navbar-nav me-auto">
      <li class="nav-item">
        <a
          class="nav-link<%= currentNav === 'home' ? ' active' : '' %>"
          href="/feed"
          >Home</a
        >
      </li>
      <li class="nav-item">
        <a
          class="nav-link<%= currentNav === 'shows' ? ' active' : '' %>"
          href="/shows"
          >TV Shows</a
        >
      </li>
      <li class="nav-item">
        <a
          class="nav-link<%= currentNav === 'movies' ? ' active' : '' %>"
          href="/movies"
          >Movies</a
        >
      </li>
      <li class="nav-item">
        <a
          class="nav-link<%= currentNav === 'list' ? ' active' : '' %>"
          href="/my-list"
          >My List</a
        >
      </li>
      <li class="nav-item dropdown">
        <a
          class="nav-link dropdown-toggle<%= currentNav === 'genres' ? ' active' : '' %>"
          href="#"
          id="genresDropdown"
          role="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          Browse by Genres
        </a>
        <ul
          class="dropdown-menu bg-dark"
          aria-labelledby="genresDropdown"
          id="genresDropdownMenu"
        >
          <li>
            <a class="dropdown-item text-white" href="#">Loading genres...</a>
          </li>
        </ul>
      </li>
      <li class="nav-item dropdown" id="adminNavItem" style="display: none">
        <a
          id="adminDropdown"
          class="nav-link dropdown-toggle<%= currentNav === 'admin' ? ' active' : '' %>"
          href="#"
          role="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          Admin <i class="bi bi-gear-fill ms-2"></i>
        </a>
        <ul
          class="dropdown-menu dropdown-menu-end bg-dark"
          aria-labelledby="adminDropdown"
          style="min-width: 180px"
        >
          <li>
            <a
              class="dropdown-item text-white text-start"
              href="/admin/add-content"
            >
              <i class="bi bi-plus-circle ms-2 me-2"></i> Add Content
            </a>
          </li>
          <li>
            <a class="dropdown-item text-white text-start" href="/admin/edit">
              <i class="bi bi-pencil-square ms-2 me-2"></i> Edit Content
            </a>
          </li>
        </ul>
      </li>
    </ul>
    <div class="d-flex align-items-center gap-2">
      <p class="mb-0 text-white" id="helloMessage">Hello USERNAME</p>
      <span class="icon-btn" data-search-target="searchInput"
        ><i class="bi bi-search"></i
      ></span>
      <input
        id="searchInput"
        type="text"
        class="form-control form-control-sm bg-dark text-white"
        placeholder="Search..."
        style="display: none; width: 180px"
      />
      <span class="icon-btn"><i class="bi bi-alphabet"></i></span>
      <span class="icon-btn"><i class="bi bi-bell"></i></span>
      <div class="nav-item dropdown">
        <a
          id="profileDropdown"
          class="nav-link dropdown-toggle p-0"
          role="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          <img
            id="currentProfileImg"
            src="/images/profiles/yellow.png"
            alt="Profile"
            class="profile-img"
          />
        </a>
        <ul
          class="dropdown-menu dropdown-menu-end bg-dark"
          aria-labelledby="profileDropdown"
          style="min-width: 180px"
        >
          <li>
            <a class="dropdown-item text-white text-start" href="profiles">
              <i class="bi bi-person-circle ms-2 me-2"></i> Select Profile
            </a>
          </li>
          <li>
            <a class="dropdown-item text-white text-start" href="/settings">
              <i class="bi bi-gear ms-2 me-2"></i> Manage Profiles
            </a>
          </li>
          <li>
            <a
              class="dropdown-item text-white text-start"
              onclick="logout()"
              style="cursor: pointer"
            >
              <i class="bi bi-box-arrow-right ms-2 me-2"></i> Log Out
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<div
  class="offcanvas offcanvas-end bg-dark text-white"
  tabindex="-1"
  id="mobileNavbar"
  aria-labelledby="mobileNavbarLabel"
>
  <div class="offcanvas-header border-bottom border-secondary">
    <h5 class="offcanvas-title" id="mobileNavbarLabel">Browse</h5>
    <button
      type="button"
      class="btn-close btn-close-white"
      data-bs-dismiss="offcanvas"
      data-offcanvas-close
      aria-label="Close"
    ></button>
  </div>
  <div class="offcanvas-body d-flex flex-column gap-4">
    <div class="d-flex align-items-center gap-3">
      <img
        id="currentProfileImgMobile"
        src="/images/profiles/yellow.png"
        alt="Profile"
        class="profile-img"
      />
      <p class="mb-0 text-white" id="helloMessageMobile">Hello USERNAME</p>
    </div>
    <div class="d-flex flex-column gap-2">
      <a
        class="text-white text-decoration-none"
        href="profiles"
        data-offcanvas-close
      >
        <i class="bi bi-person-circle me-2"></i>Select Profile
      </a>
      <a
        class="text-white text-decoration-none"
        href="/settings"
        data-offcanvas-close
      >
        <i class="bi bi-gear me-2"></i>Manage Profiles
      </a>
    </div>
    <ul class="navbar-nav flex-column gap-1">
      <li class="nav-item">
        <a class="nav-link text-white" href="/feed" data-offcanvas-close
          >Home</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/shows" data-offcanvas-close
          >TV Shows</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/movies" data-offcanvas-close
          >Movies</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/my-list" data-offcanvas-close
          >My List</a
        >
      </li>
      <li class="nav-item" id="adminNavItemMobile" style="display: none">
        <div class="d-flex flex-column gap-2">
          <a
            class="text-white text-decoration-none"
            href="/admin/add-content"
            data-offcanvas-close
          >
            <i class="bi bi-plus-circle me-2"></i>Add Content
          </a>
          <a
            class="text-white text-decoration-none"
            href="/admin/edit"
            data-offcanvas-close
          >
            <i class="bi bi-pencil-square me-2"></i>Edit Content
          </a>
        </div>
      </li>
    </ul>
    <div>
      <p class="text-uppercase text-secondary mb-2 small">Browse by Genres</p>
      <div id="genresDropdownMenuMobile" class="d-flex flex-column gap-1">
        <span class="text-white-50 small">Loading genres...</span>
      </div>
    </div>
    <button
      class="btn btn-outline-light btn-sm align-self-start"
      type="button"
      onclick="logout()"
      data-offcanvas-close
    >
      <i class="bi bi-box-arrow-right me-1"></i> Log Out
    </button>
  </div>
</div>

<script>
  (function () {
    if (window.__navbarOffcanvasHooked) return;
    window.__navbarOffcanvasHooked = true;

    const hookOffcanvasListeners = () => {
      const offcanvasEl = document.getElementById("mobileNavbar");
      if (!offcanvasEl || !window.bootstrap || !window.bootstrap.Offcanvas) {
        return;
      }

      const offcanvasInstance =
        window.bootstrap.Offcanvas.getOrCreateInstance(offcanvasEl);

      offcanvasEl.addEventListener("click", (event) => {
        const trigger = event.target.closest("[data-offcanvas-close]");
        if (!trigger) return;

        window.requestAnimationFrame(() => {
          offcanvasInstance.hide();
        });
      });
    };

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", hookOffcanvasListeners);
    } else {
      hookOffcanvasListeners();
    }
  })();
</script>
