<!DOCTYPE html>
<html lang="en" dir="ltr">
  <%- include('partials/head', { extraCss: ["/style/login_page.css"] }) %>

  <body>
    <%- include('partials/admin_navbar') %>

    <div class="row justify-content-center align-items-center"
      style="min-height: 80vh">
      <div class="container-fluid"></div>
      <div class="container-fluid">

        <div class="login-container">
          <form action="/admin/add-content" method="POST"
            enctype="multipart/form-data" novalidate>
            <h2 class="form-title text-white mb-4">Add New Content</h2>

            <div class="form-row">
              <select name="type" class="form-control mb-3">
                <option value="">Select Type</option>
                <option value="movie">Movie</option>
                <option value="show">Show</option>
                <option value="episode">Episode</option>
              </select>

              <div class="form-row" id="dateRow">
                <input type="number" class="form-control mb-3" name="year"
                  placeholder="Release Year" value="2025" min="1900" max="2025"
                  step="1" />
                <input type="date" id="releaseDateField"
                  class="form-control mb-3"
                  name="releaseDate" placeholder="Release Date"
                  style="display: none;" />
              </div>
            </div>

            <!-- Existing title field -->
            <input
              type="text"
              id="titleField"
              class="form-control mb-3"
              name="title"
              placeholder="Title"
              required />

            <!-- Only for episodes -->
            <div id="episodeFields" class="form-row" style="display: none;">
              <input type="number" class="form-control mb-3" name="seasonNumber"
                placeholder="Season Number" min="1" />
              <input type="number" class="form-control mb-3"
                name="episodeNumber"
                placeholder="Episode Number" min="1" />
            </div>

            <div class="form-check mb-3 d-flex align-items-center"
              style="gap: 8px;">
              <input class="form-check-input" type="checkbox"
                id="imdbAutoFill" />
              <label class="form-check-label text-white" for="imdbAutoFill">
                Pull information from IMDb
              </label>
              <img
                src="https://upload.wikimedia.org/wikipedia/commons/6/69/IMDB_Logo_2016.svg"
                alt="IMDb"
                style="height: 22px; margin-left: 5px;" />
            </div>

            <div id="imdbInfoMessage" class="alert alert-warning"
              style="display:none; position:relative; padding:6px 12px; font-size:0.95rem; margin-bottom:10px;">
              <span id="imdbInfoText"></span>
              <button type="button" id="imdbInfoClose"
                style="position:absolute; top:4px; right:6px; border:none; background:none; font-weight:bold; cursor:pointer;">×</button>
            </div>

            <!-- New episode title field (hidden initially) -->
            <input
              type="text"
              id="episodeTitleField"
              class="form-control mb-3"
              name="episodeTitle"
              placeholder="Episode Title"
              style="display: none;" />

            <!-- Existing description -->
            <textarea
              id="descriptionField"
              class="form-control mb-3"
              name="description"
              placeholder="Description"
              rows="3"></textarea>

            <!-- New Episode Description (hidden by default) -->
            <textarea
              id="episodeDescriptionField"
              class="form-control mb-3"
              name="episodeDescription"
              placeholder="Episode Description"
              rows="3"
              style="display: none;"></textarea>

            <div id="imdbRatingContainer" class="text-white mb-3"
              style="display: none;">
              <strong>IMDb Rating:</strong> <span id="imdbRating">N/A</span>
            </div>

            <!-- Dynamic genre section -->
            <div id="genresSection" class="form-group mb-3">
              <button type="button" id="toggleGenres"
                class="btn btn-secondary w-100 mb-2"
                style="background-color: #333; border: none;">
                Choose Genres ▾
              </button>

              <div id="genresContainer"
                style="display: none; background-color: #222; padding: 10px; border-radius: 8px;">

                <% if (genres && genres.length > 0) { %>
                <% genres.forEach(function(genre) { %>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="genres"
                    value="<%= genre %>" id="genre<%= genre %>">
                  <label class="form-check-label text-white"
                    for="genre<%= genre %>"><%= genre %></label>
                </div>
                <% }); %>
                <% } else { %>
                <p class="text-white mb-2">No existing genres found,add your own
                  below</p>
                <% } %>

                <div class="form-check mt-2">
                  <input class="form-check-input" type="checkbox"
                    id="genreOther" value="Other">
                  <label class="form-check-label text-white"
                    for="genreOther">Other</label>
                </div>

                <div id="otherGenresArea"
                  style="display: none; margin-top: 10px;">
                  <div class="d-flex mb-2 align-items-center">
                    <input type="text" id="newGenreInput" class="form-control"
                      placeholder="Enter new genre"
                      style="flex: 1; height: 42px; font-size: 0.95rem;" />
                    <button type="button" id="addGenreBtn"
                      class="btn btn-netflix"
                      style="
                        margin-left: 8px;
                        width: 90px;
                        height: 42px;
                        border-radius: 4px;
                        font-size: 0.95rem;
                        padding: 0;
                      ">
                      Add
                    </button>
                  </div>

                  <div id="addedGenres"
                    style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
                </div>
              </div>
            </div>

            <input type="text" id="directorField" class="form-control mb-3"
              name="director" placeholder="Director" />
            <input type="text" id="actorsField" class="form-control mb-3"
              name="actors" placeholder="Actors (comma separated)" />

            <input type="url" class="form-control mb-3" name="posterUrl"
              placeholder="Poster URL" />

            <!-- Only for movies or episodes -->
            <div id="videoFields" style="display: none;">
              <div>
                <input type="file" class="form-control mb-3" name="videoFile"
                  accept="video/mp4" required />
              </div>
            </div>

            <button type="submit" class="btn btn-netflix">Upload
              Content</button>
          </form>
        </div>
        <script src="/scripts/add_content_page.js"></script>
      </div>
    </div>
  </body>
</html>
