<!DOCTYPE html>
<html lang="en" dir="ltr">
        <%- include('partials/head', { extraCss: [
          "/style/navbar.css",
          "/style/dropdown.css",
          "/style/main_menu.css",
          "/style/form_styles.css"
        ] }) %>    <body>
        <%- include('partials/navbar', { activeNav: 'admin' }) %>

        <div class="row justify-content-center align-items-center"
            style="min-height: 80vh; margin-top: 80px;">
            <div class="container-fluid"></div>
            <div class="container-fluid">

                <div class="login-container">
                    <form action="/admin/edit/<%= content._id %>" method="POST"
                        enctype="multipart/form-data" novalidate>
                        <h2 class="form-title text-white mb-4">Edit Content</h2>
                        <br />
                        <div class="form-row">
                            <select name="type" class="form-control mb-3">
                                <option value>Select Type</option>
                                <option value="movie" <% if(content.type ===
                                    'Movie') { %>selected<% } %>>Movie</option>
                                <option value="show" <% if(content.type ===
                                    'Show') { %>selected<% } %>>Show</option>
                                <option value="episode" <% if(content.type ===
                                    'Episode') { %>selected<% }
                                    %>>Episode</option>
                            </select>

                            <div class="form-row" id="dateRow">
                                <input type="number" class="form-control mb-3"
                                    name="year"
                                    placeholder="Release Year"
                                    value="<%= content.releaseYear || '' %>"
                                    min="1900" max="2025"
                                    step="1" />
                                <input type="date" id="releaseDateField"
                                    class="form-control mb-3"
                                    name="releaseDate"
                                    placeholder="Release Date"
                                    value="<% if(content.releaseDate) { %><%= content.releaseDate.toISOString().split('T')[0] %><% } %>"
                                    <% if(content.type !== 'Episode') {
                                    %>style="display: none;"<% } %> />
                            </div>
                        </div>

                        <!-- Title field -->
                        <input
                            type="text"
                            id="titleField"
                            class="form-control mb-3"
                            name="title"
                            placeholder="<% if(content.type === 'Episode') { %>Show Title<% } else { %>Title<% } %>"
                            value="<%= content.title || '' %>"
                            required />

                        <!-- Only for episodes -->
                        <div id="episodeFields" class="form-row" <%
                            if(content.type !== 'Episode') {
                            %>style="display: none;"<% } %>>
                            <input type="number" class="form-control mb-3"
                                name="seasonNumber"
                                placeholder="Season Number" min="1"
                                value="<% if(content.type === 'Episode') { %><%= content.seasonNumber || '' %><% } %>" />
                            <input type="number" class="form-control mb-3"
                                name="episodeNumber"
                                placeholder="Episode Number" min="1"
                                value="<% if(content.type === 'Episode') { %><%= content.episodeNumber || '' %><% } %>" />
                        </div>

                        <div class="form-check mb-3 d-flex align-items-center"
                            style="gap: 8px;">
                            <input class="form-check-input" type="checkbox"
                                id="imdbAutoFill" />
                            <label class="form-check-label text-white"
                                for="imdbAutoFill">
                                Pull information from IMDb
                            </label>
                            <img
                                src="https://upload.wikimedia.org/wikipedia/commons/6/69/IMDB_Logo_2016.svg"
                                alt="IMDb"
                                style="height: 22px; margin-left: 5px;" />
                        </div>

                        <div id="imdbInfoMessage" class="alert alert-warning"
                            style="display:none; position:relative; padding:6px 12px; font-size:0.95rem; margin-bottom:10px;">
                            <span id="imdbInfoText"></span>
                            <button type="button" id="imdbInfoClose"
                                style="position:absolute; top:4px; right:6px; border:none; background:none; font-weight:bold; cursor:pointer;">×</button>
                        </div>

                        <!-- Episode title field (for episodes only) -->
                        <input
                            type="text"
                            id="episodeTitleField"
                            class="form-control mb-3"
                            name="episodeTitle"
                            placeholder="Episode Title"
                            value="<% if(content.type === 'Episode') { %><%= content.episodeTitle || '' %><% } %>"
                            <% if(content.type !== 'Episode') {
                            %>style="display: none;"<% } %> />

                        <!-- Description for movies/shows -->
                        <textarea
                            id="descriptionField"
                            class="form-control mb-3"
                            name="description"
                            placeholder="Description"
                            rows="3"
                            <% if(content.type === 'Episode') {
                            %>style="display: none;"<% } %>><% if(content.type !== 'Episode') { %><%= content.description || '' %><% } %></textarea>

                        <!-- Episode Description (for episodes only) -->
                        <textarea
                            id="episodeDescriptionField"
                            class="form-control mb-3"
                            name="episodeDescription"
                            placeholder="Episode Description"
                            rows="3"
                            <% if(content.type !== 'Episode') {
                            %>style="display: none;"<% } %>><% if(content.type === 'Episode') { %><%= content.description || '' %><% } %></textarea>

                        <div id="imdbRatingContainer" class="text-white mb-3"
                            <% if(!content.imdbRating) {
                            %>style="display: none;"<% } %>>
                            <strong>IMDb Rating:</strong> <span
                                id="imdbRating"><%= content.imdbRating || 'N/A'
                                %></span>
                        </div>

                        <!-- Dynamic genre section (hidden for episodes) -->
                        <div id="genresSection" class="form-group mb-3" <%
                            if(content.type === 'Episode') {
                            %>style="display: none;"<% } %>>
                            <button type="button" id="toggleGenres"
                                class="btn btn-secondary w-100 mb-2"
                                style="background-color: #333; border: none;">
                                Choose Genres ▾
                            </button>

                            <div id="genresContainer"
                                style="display: none; background-color: #222; padding: 10px; border-radius: 8px;">

                                <% if (genres && Array.isArray(genres) &&
                                genres.length > 0) { %>
                                <% genres.forEach(function(genre) { %>
                                <div class="form-check">
                                    <input class="form-check-input"
                                        type="checkbox" name="genres"
                                        value="<%= genre %>"
                                        id="genre<%= genre %>"
                                        <% if(content.genres &&
                                        Array.isArray(content.genres) &&
                                        content.genres.includes(genre)) {
                                        %>checked<% } %>>
                                    <label class="form-check-label text-white"
                                        for="genre<%= genre %>"><%= genre
                                        %></label>
                                </div>
                                <% }); %>
                                <% } else { %>
                                <p class="text-white mb-2">No existing genres
                                    found, add your own below</p>
                                <% } %>

                                <div class="form-check mt-2">
                                    <input class="form-check-input"
                                        type="checkbox"
                                        id="genreOther" value="Other">
                                    <label class="form-check-label text-white"
                                        for="genreOther">Other</label>
                                </div>

                                <div id="otherGenresArea"
                                    style="display: none; margin-top: 10px;">
                                    <div class="d-flex mb-2 align-items-center">
                                        <input type="text" id="newGenreInput"
                                            class="form-control"
                                            placeholder="Enter new genre"
                                            style="flex: 1; height: 42px; font-size: 0.95rem;" />
                                        <button type="button" id="addGenreBtn"
                                            class="btn btn-netflix"
                                            style="
                                                margin-left: 8px;
                                                width: 90px;
                                                height: 42px;
                                                border-radius: 4px;
                                                font-size: 0.95rem;
                                                padding: 0;
                                            ">
                                            Add
                                        </button>
                                    </div>

                                    <div id="addedGenres"
                                        style="display: flex; flex-wrap: wrap; gap: 6px;">
                                        <% if (content.genres &&
                                        Array.isArray(content.genres)) { %>
                                        <%
                                        content.genres.forEach(function(genre) {
                                        %>
                                        <% if (!genres || !Array.isArray(genres)
                                        || !genres.includes(genre)) { %>
                                        <div class="genre-tag">
                                            <span><%= genre %></span>
                                            <button type="button"
                                                class="remove-genre"
                                                style="background:none; border:none; color:#e50914; margin-left:6px;">✖</button>
                                            <input type="hidden" name="genres"
                                                value="<%= genre %>">
                                        </div>
                                        <% } %>
                                        <% }); %>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <input type="text" id="directorField"
                            class="form-control mb-3"
                            name="director" placeholder="Director"
                            value="<%= content.director || '' %>"
                            <% if(content.type === 'Episode') {
                            %>style="display: none;"<% } %> />
                        <input type="text" id="actorsField"
                            class="form-control mb-3"
                            name="actors" placeholder="Actors (comma separated)"
                            value="<% if(content.actors) { %><%= content.actors.join(', ') %><% } %>"
                            <% if(content.type === 'Episode') {
                            %>style="display: none;"<% } %> />

                        <input type="url" class="form-control mb-3"
                            name="posterUrl"
                            placeholder="Poster URL"
                            value="<%= content.posterUrl || '' %>" />

                        <!-- Only for movies or episodes -->
                        <div id="videoFields" <% if(content.type !== 'Movie' &&
                            content.type !== 'Episode') {
                            %>style="display: none;"<% } %>>
                            <div class="mb-3">
                                <label class="form-label text-white">Current
                                    Video:</label>
                                <p class="text-muted small"><%= content.videoUrl
                                    || 'No video uploaded' %></p>
                            </div>
                            <div>
                                <label class="form-label text-white">Upload New
                                    Video (optional):</label>
                                <input type="file" class="form-control mb-3"
                                    name="videoFile"
                                    accept="video/mp4" />
                                <small class="text-muted">Leave empty to keep
                                    existing video</small>
                            </div>
                        </div>

                        <div class="button-row">
                            <button type="submit" class="btn btn-netflix">Update
                                Content</button>
                            <button type="button" id="deleteBtn"
                                class="btn btn-danger">Delete
                                Content</button>
                            <a href="/feed"
                                class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
                <script src="/scripts/login_handler.js"></script>
                <script src="/scripts/form_scripts.js"></script>
                <script src="/scripts/init.js"></script>
                <script src="/scripts/admin_init.js"></script>
            </div>
        </div>
    </body>
</html>