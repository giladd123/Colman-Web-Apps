<!-- Gilad-Tidhar-325767929-Rotem-Batstein-325514917-Shani-Bashari-325953743 -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Netflix</title>
    <link rel="icon" href="images/favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      body {
        margin: 0;
        background-color: #000;
      }
      .navbar {
        background: linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0.9),
          rgba(0, 0, 0, 0.1)
        );
      }
      .navbar-brand {
        font-size: 1.5rem;
        font-weight: bold;
        color: #e50914 !important;
      }
      .nav-link {
        color: #e5e5e5 !important;
        margin-right: 15px;
        font-size: 0.95rem;
      }
      .nav-link.active {
        font-weight: bold;
        color: #fff !important;
      }
      .profile-img {
        width: 35px;
        height: 32px;
        border-radius: 4px;
      }
      .icon-btn {
        color: white;
        margin-left: 15px;
        font-size: 1.2rem;
        cursor: pointer;
      }

      .dropdown-menu {
        padding: 0;
        border: none;
        background-color: transparent;
        min-width: auto;
      }

      .dropdown-item.text-white:hover {
        background-color: rgba(255, 255, 255, 0.04);
      }

      .dropdown-item {
        padding: 8px 0 !important;
        margin: 0 !important;
        text-align: center;
        display: block;
        border: none;
      }

      .dropdown-item img {
        width: 40px;
        height: 28px;
        border: none;
        border-radius: 4px;
        display: block;
        margin: 0 auto;
      }

      .row-section {
        position: relative;
        margin-bottom: 24px;
      }
      .row-title {
        color: #e5e5e5;
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0 0 8px 4px;
      }
      .scroll-wrapper {
        position: relative;
      }
      .scroll-container {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        scroll-behavior: smooth;
        padding-bottom: 6px;
      }
      .scroll-container::-webkit-scrollbar {
        display: none;
      }
      .scroll-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 38px;
        height: 62%;
        min-height: 120px;
        border: none;
        background: rgba(0, 0, 0, 0.35);
        color: white;
        z-index: 2;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
      }
      .scroll-wrapper:hover .scroll-btn {
        opacity: 1;
      }
      .scroll-btn.left { left: 0; }
      .scroll-btn.right { right: 0; }
      .movie-card {
        flex: 0 0 auto;
        width: 180px;
        height: 270px;
        border-radius: 6px;
        overflow: hidden;
        background-color: #141414;
        position: relative;
        transition: transform 0.2s ease-in-out;
      }
      .movie-card:hover {
        transform: scale(1.06);
        z-index: 1;
      }
      .movie-poster {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .badge-pill {
        position: absolute;
        left: 8px;
        top: 8px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        font-size: 0.75rem;
        padding: 2px 8px;
        border-radius: 999px;
      }

      .like-btn {
        position: absolute;
        bottom: 8px;
        right: 8px;
        z-index: 2;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 3px;
        border: none;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s ease, color 0.2s ease;
      }
      .like-btn.liked { color: #e50914; }
      .like-btn .bi-heart-fill { color: #e50914; }

      .like-btn i {
        display: inline-block;
        position: relative;
        transform-origin: center center;
        line-height: 1;
      }

      .like-btn:hover i {
        transform: scale(1.2);
      }
      .like-btn:focus {
        outline: 2px solid #e50914;
        outline-offset: 2px;
      }

      @keyframes heart-bounce {
        0%   { transform: scale(1); }
        30%  { transform: scale(1.4); }
        60%  { transform: scale(0.9); }
        100% { transform: scale(1); }
      }
      .like-btn i.like-animate {
        animation: heart-bounce 0.45s ease;
        position: relative;
      }
      .like-btn i.like-animate::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 2.6rem;
        height: 2.6rem;
        background: rgba(229, 9, 20, 0.5);
        border-radius: 50%;
        transform: translate(-50%, -50%) scale(0);
        pointer-events: none;
        animation: heart-glow 0.45s ease forwards;
      }
      @keyframes heart-glow {
        0%   { opacity: 0.9; transform: translate(-50%, -50%) scale(0); }
        100% { opacity: 0;   transform: translate(-50%, -50%) scale(2.5); }
      }
      @keyframes heart-unlike {
        0%   { transform: rotate(0deg) scale(1); color: #e50914; }
        25%  { transform: rotate(-15deg) scale(0.9); color: rgba(255,255,255,0.7); }
        50%  { transform: rotate(15deg) scale(0.9); color: rgba(255,255,255,0.7); }
        75%  { transform: rotate(-10deg) scale(0.95); color: rgba(255,255,255,0.7); }
        100% { transform: rotate(0deg) scale(1); color: #fff; }
      }
      .like-btn i.unlike-animate {
        animation: heart-unlike 0.45s ease;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg px-4">
      <a class="navbar-brand" href="#">NETFLIX</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link active" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#">TV Shows</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Movies</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Games</a></li>
          <li class="nav-item">
            <a class="nav-link" href="#">New & Popular</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="#">My List</a></li>
          <li class="nav-item">
            <a class="nav-link" href="#">Browse by Languages</a>
          </li>
        </ul>
        <div class="d-flex align-items-center">
          <p class="mb-0 text-white" id="helloMessage">Hello USERNAME</p>
          <span class="icon-btn"><i class="bi bi-search"></i></span>
          <input
            id="searchInput"
            type="text"
            class="form-control form-control-sm bg-dark text-white ms-2"
            placeholder="Search..."
            style="display:none; width: 180px;"
          />
          <span class="icon-btn"><i class="bi bi-alphabet"></i></span>
          <span class="icon-btn"><i class="bi bi-bell"></i></span>

          <div class="nav-item dropdown ms-2">
            <a id="profileDropdown"
              class="nav-link dropdown-toggle p-0"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <img
                id="currentProfileImg"
                src="images/profiles/yellow.png"
                alt="Profile"
                class="profile-img"
              />
            </a>

            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown" style="min-width:180px;">
              <li>
                <a class="dropdown-item text-white text-start" href="profiles-page.html">
                  <i class="bi bi-person-circle me-2"></i> Select Profile
                </a>
              </li>
              <li>
                <a class="dropdown-item text-white text-start" onclick="logout()">
                    <i class="bi bi-box-arrow-right me-2"></i> Log Out
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <div id="content" class="container py-4"></div>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="movies.js"></script>
    <script>
      selectedProfileName = localStorage.getItem("selectedProfileName")
      selectedProfileImage = localStorage.getItem("selectedProfileImage")
      selectedProfileImage = selectedProfileImage ? selectedProfileImage : "images/profiles/yellow.png"

      if (!selectedProfileName) {
        window.location.href = "profiles-page.html";
      }
      else {
        document.getElementById("helloMessage").innerText = `Hello, ${selectedProfileName}`;
        document.getElementById("currentProfileImg").src = selectedProfileImage;
      }
      function logout() {
        localStorage.clear();
        window.location.href = "login_page.html";
      }
      (function () {
        const ROW_SIZE = 12;
        const ROW_TITLES = [
          'Popular',
          'Trending',
          'Because you watched',
          'Watch it Again',
          'Top Rated',
          "Action"
        ];

        function chunkArray(items, chunkSize) {
          const chunks = [];
          for (let i = 0; i < items.length; i += chunkSize) {
            chunks.push(items.slice(i, i + chunkSize));
          }
          return chunks;
        }

        function updateTooltip(el, text) {
          try {
            const inst = bootstrap.Tooltip.getInstance(el);
            if (inst) inst.dispose();
          }
          catch (e) {}
          el.setAttribute('title', text);
          el.setAttribute('data-bs-original-title', text);
          new bootstrap.Tooltip(el);
        }

        function createCard(movie) {
          const card = document.createElement('div');
          card.className = 'movie-card';

          const badge = document.createElement('span');
          badge.className = 'badge-pill';
          badge.textContent = movie.imdbRating ? `${movie.imdbRating}` : movie.Year || '';

          const img = document.createElement('img');
          img.className = 'movie-poster';
          img.alt = movie.Title || 'Poster';
          img.src = movie.Poster;
          img.loading = "lazy";

          // Like button
          const likeBtn = document.createElement('button');
          likeBtn.className = 'like-btn';
          likeBtn.setAttribute('data-bs-toggle', 'tooltip');

          const movieId = movie.imdbID || movie.Title;
          const likesDataAll = JSON.parse(localStorage.getItem('likesData')) || {};

          let entry = likesDataAll[movieId];
          if (!entry) {
            entry = {
              base: Math.floor(Math.random() * (500 - 50 + 1)) + 50,
              extra: 0,
              liked: false
            };
            likesDataAll[movieId] = entry;
            localStorage.setItem('likesData', JSON.stringify(likesDataAll));
          }

          entry.base = Number(entry.base);
          entry.extra = Number(entry.extra);

          const totalLikes = entry.base + entry.extra;
          likeBtn.innerHTML = `<i class="bi ${entry.liked ? 'bi-heart-fill' : 'bi-heart'}"></i>
                              <span class="like-count">${totalLikes}</span>`;
          likeBtn.setAttribute('aria-pressed', entry.liked ? 'true' : 'false');
          likeBtn.setAttribute('aria-label', entry.liked ? 'Unlike this movie' : 'Like this movie');

          const tooltipText = entry.liked ? `Unlike üíî` : 'Like ‚ù§Ô∏è';
          updateTooltip(likeBtn, tooltipText);

          likeBtn.addEventListener('click', () => {
            const stored = JSON.parse(localStorage.getItem('likesData')) || {};
            const cur = stored[movieId] || { base: entry.base, extra: entry.extra, liked: entry.liked };

            const icon = likeBtn.querySelector('i');

            if (!cur.liked) {
              cur.liked = true;
              cur.extra = (cur.extra || 0) + 1;
              likeBtn.classList.add('liked');

              if (icon) {
                icon.classList.replace('bi-heart', 'bi-heart-fill');
                icon.classList.remove('like-animate');
                void icon.offsetWidth;
                icon.classList.add('like-animate');
                setTimeout(() => icon.classList.remove('like-animate'), 450);
              }
            } else {
              cur.liked = false;
              cur.extra = Math.max(0, (cur.extra || 0) - 1);
              likeBtn.classList.remove('liked');

              if (icon) {
                icon.classList.replace('bi-heart-fill', 'bi-heart');
                icon.classList.remove('unlike-animate');
                void icon.offsetWidth;
                icon.classList.add('unlike-animate');
                setTimeout(() => icon.classList.remove('unlike-animate'), 300);
              }
            }

            stored[movieId] = cur;
            localStorage.setItem('likesData', JSON.stringify(stored));

            const newTotal = cur.base + cur.extra;
            const countEl = likeBtn.querySelector('.like-count');
            if (countEl) countEl.textContent = newTotal;

            likeBtn.setAttribute('aria-pressed', cur.liked ? 'true' : 'false');
            likeBtn.setAttribute('aria-label', cur.liked ? 'Unlike this movie' : 'Like this movie');
            const newTooltip = cur.liked ? `Unlike üíî` : 'Like ‚ù§Ô∏è';
            updateTooltip(likeBtn, newTooltip);
          });

          card.appendChild(img);
          card.appendChild(badge);
          card.appendChild(likeBtn);

          return card;
        }

        function createRow(title, movies, rowIndex) {
          const section = document.createElement('section');
          section.className = 'row-section';

          const h3 = document.createElement('h3');
          h3.className = 'row-title';
          h3.textContent = title;

          const wrapper = document.createElement('div');
          wrapper.className = 'scroll-wrapper';

          const leftBtn = document.createElement('button');
          leftBtn.className = 'scroll-btn left';
          leftBtn.innerHTML = '<i class="bi bi-chevron-left fs-3"></i>';

          const rightBtn = document.createElement('button');
          rightBtn.className = 'scroll-btn right';
          rightBtn.innerHTML = '<i class="bi bi-chevron-right fs-3"></i>';

          const scroller = document.createElement('div');
          scroller.className = 'scroll-container';
          scroller.id = `row-${rowIndex}`;

          movies.forEach((movie) => {
            const card = createCard(movie);
            scroller.appendChild(card);
          });

          leftBtn.addEventListener('click', () => scroller.scrollBy({ left: -600, behavior: 'smooth' }));
          rightBtn.addEventListener('click', () => scroller.scrollBy({ left: 600, behavior: 'smooth' }));

          wrapper.appendChild(leftBtn);
          wrapper.appendChild(scroller);
          wrapper.appendChild(rightBtn);

          section.appendChild(h3);
          section.appendChild(wrapper);
          return section;
        }

        function loadAndRender() {
          const content = document.getElementById('content');
          content.innerHTML = '';

          const chunks = chunkArray(movies, ROW_SIZE);
          chunks.forEach((chunk, i) => {
            const title = ROW_TITLES[i % ROW_TITLES.length];
            const row = createRow(title, chunk, i);
            content.appendChild(row);
          });
        }

        function renderMovies(filtered) {
          const movieCards = document.getElementById('content');
          movieCards.innerHTML = ''; // clear previous content

          if (filtered.length === 0) {
            const noResult = document.createElement('p');
            noResult.textContent = 'No results found';
            noResult.style.color = 'white';
            noResult.style.fontSize = '1.5rem';
            noResult.style.textAlign = 'center';
            movieCards.appendChild(noResult);
            return;
          }

          movieCards.style.display = 'flex';
          movieCards.style.flexWrap = 'wrap';
          movieCards.style.gap = '16px';
          movieCards.style.padding = '20px';

          filtered.forEach(movie => {
            const card = createCard(movie);
            movieCards.appendChild(card);
          });
        }

        document.addEventListener('DOMContentLoaded', loadAndRender);

        // add search functionality
        const searchIcon = document.querySelector('.bi-search');
        const searchInput = document.getElementById('searchInput');
        // open or close search input on icon click
        searchIcon.addEventListener('click', () => {
          if (searchInput.style.display === 'block') {
            searchInput.style.display = 'none';
            searchInput.value = '';
            // reset content styles to fit original layout
            const movieCards = document.getElementById('content');
            movieCards.style.display = '';
            movieCards.style.flexWrap = '';
            movieCards.style.gap = '';
            movieCards.style.padding = '';
            loadAndRender();
          } else {
            searchInput.style.display = 'block';
            searchInput.focus();
          }
        });
        // filter content on input
        searchInput.addEventListener('input', (e) => {
          const query = e.target.value.toLowerCase();
          const filtered = movies.filter(movie => movie.Title.toLowerCase().includes(query));
          renderMovies(filtered);
        });

        // add alphabetical sorting functionality
        const AbcIcon = document.querySelector('.bi-alphabet');
        // show sorted A-Z list on icon click or reset to original
        let AbcActive = false;
        AbcIcon.addEventListener('click', () => {
          // if abc button is clicked
          AbcActive = !AbcActive;
          if (AbcActive) {
            AbcIcon.style.backgroundColor = '#FFFFFF80'; // highlight
            AbcIcon.style.borderRadius = '4px'; // optional rounded effect
            movies.sort((a, b) => a.Title.localeCompare(b.Title));
            renderMovies(movies);
          } else {
            AbcIcon.style.backgroundColor = 'transparent'; // reset
            // reset content styles to fit original layout
            const movieCards = document.getElementById('content');
            movieCards.style.display = '';
            movieCards.style.flexWrap = '';
            movieCards.style.gap = '';
            movieCards.style.padding = '';
            loadAndRender();
          }
        });
      })();
    </script>
  </body>
</html>
